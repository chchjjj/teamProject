<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.teamProject.product.mapper.ProductMapper">
	
	<select id="proInfo" parameterType="hashmap" resultType="com.example.teamProject.product.model.Product"> 
		SELECT *			
		FROM PRODUCT_TBL P
		INNER JOIN SELLER_INFO_TBL S
		ON P.STORE_ID = S.STORE_ID
		WHERE PRO_NO = #{proNo}
	</select>
	
	<!--옵션 관리-->
	<!--상위옵션-->
	<select id="topOptList" parameterType="hashmap" resultType="com.example.teamProject.product.model.Product"> 
		SELECT *			
		FROM PRODUCT_OPTION_TBL 
		WHERE PRO_NO = #{proNo}
	</select>

	<!--상위옵션+하위옵션-->
	<select id="allOptList" parameterType="hashmap" resultType="com.example.teamProject.product.model.Product"> 
		SELECT * FROM PRODUCT_OPTION_TBL T
		LEFT JOIN PRODUCT_SUB_OPTION_TBL S ON T.TOP_OPTION_ID = S.TOP_OPTION_ID
		WHERE PRO_NO = #{proNo}
	</select>
	
	<!--장바구니 불러오기-->
	<select id="cart" parameterType="hashmap" resultType="com.example.teamProject.product.model.Product"> 
		SELECT 
		    c.CART_ID,
		    p.PRO_NAME,
		    P.PRICE AS DEF_PRICE,
		    po.OPTION_NAME AS TOP_OPT,
		    pso.VALUE_NAME AS SUB_OPT,
		    co.CART_OPT_QUANTITY AS OPT_QTT,
		    NVL(pso.PRICE_DIFF, 0) AS SUB_OPT_PRICE
		FROM CART_TBL c
		JOIN PRODUCT_TBL p 
		    ON c.PRO_NO = p.PRO_NO
		JOIN CART_OPTION_TBL co 
		    ON c.CART_ID = co.CART_ID
		JOIN PRODUCT_SUB_OPTION_TBL pso 
		    ON co.SUB_OPTION_ID = pso.SUB_OPTION_ID
		JOIN PRODUCT_OPTION_TBL po 
		    ON pso.TOP_OPTION_ID = po.TOP_OPTION_ID
		WHERE USER_ID = #{userId}
	</select>
	
<!--장바구니 삭제-->
	<delete id="deleteCart" parameterType="hashmap">
		DELETE FROM CART_TBL
		WHERE CART_ID = #{cartId}
	</delete>
	
	<delete id="deleteCartOpt" parameterType="hashmap">
		DELETE FROM CART_OPTION_TBL
		WHERE CART_ID = #{cartId}
	</delete>
	
	
</mapper>