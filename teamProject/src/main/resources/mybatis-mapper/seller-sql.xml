<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.teamProject.seller.mapper.SellerMapper">

    <select id="selectStoreList" resultType="com.example.teamProject.seller.model.Seller">
       SELECT 
            STORE_ID,
            STORE_NAME,
            BUSINESS_NO,
            STORE_INTRO,
            DELIVERY_YN,
            IS_CHAT_ENABLED,
            CHAT_START,
            CHAT_END,
            STORE_ADDR,
            STORE_AREA,
            STORE_PASS,
            REJECT_REASON,
            GRADE_CODE,
            MEMBERSHIP,
            REG_DATE,
            UDATE
        FROM SELLER_INFO_TBL
        WHERE USER_ID = #{userId, jdbcType=VARCHAR}
          AND STORE_PASS = 'P'
        ORDER BY STORE_ID
    </select>

    <update id="updateStoreName">
        UPDATE SELLER_INFO_TBL
        SET STORE_NAME = #{storeName}, UDATE = SYSDATE
        WHERE STORE_ID = #{storeId}
    </update>

    <update id="updateStoreIntro">
        UPDATE SELLER_INFO_TBL
        SET STORE_INTRO = #{storeIntro}, UDATE = SYSDATE
        WHERE STORE_ID = #{storeId}
    </update>

    <update id="updateChatInfo">
        UPDATE SELLER_INFO_TBL
        SET IS_CHAT_ENABLED = #{isChatEnabled},
            CHAT_START = #{chatStart},
            CHAT_END = #{chatEnd},
            UDATE = SYSDATE
        WHERE STORE_ID = #{storeId}
    </update>
    
    <select id="selectMonthlySalesByUser" parameterType="string" resultType="map">
    SELECT 
        s.STORE_NAME,
        TO_CHAR(o.ORDER_DATE, 'YYYY-MM') AS ORDER_MONTH,
        COUNT(o.ORDER_ID) AS ORDER_COUNT,
        SUM(o.TOTAL_PRICE) AS TOTAL_SALES
    FROM 
        SELLER_INFO_TBL s
    JOIN 
        ORDER_TBL o
    ON 
        s.STORE_NAME = o.STORE_NAME
    WHERE
        s.USER_ID = #{userId}  <!-- 로그인한 사용자 파라미터 -->
    GROUP BY 
        s.STORE_NAME,
        TO_CHAR(o.ORDER_DATE, 'YYYY-MM')
    ORDER BY 
        ORDER_MONTH
</select>

<select id="selectMonthlySales" resultType="hashmap" parameterType="hashmap">
      SELECT 
        TO_CHAR(o.order_date, 'MM') AS MONTH,
        SUM(o.total_price) AS TOTAL
    FROM order_tbl o
    INNER JOIN seller_info_tbl s
        ON o.store_name = s.store_name
    WHERE s.user_id = #{userId}  <!-- 여기에 특정 판매자 아이디 조건 추가 -->
    GROUP BY TO_CHAR(o.order_date, 'MM')
    ORDER BY TO_CHAR(o.order_date, 'MM')
    </select>

</mapper>

