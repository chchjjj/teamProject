<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.teamProject.admin.mapper.AdminMapper">

	<select id="userListSelect" parameterType="hashmap" resultType="com.example.teamProject.admin.model.Admin">
   		SELECT * FROM USER_TBL
   		WHERE 1=1
   		<if test="option=='all'">
   			AND (USER_ID LIKE '%'||#{keyWord}||'%' OR USER_NAME LIKE '%'||#{keyWord}||'%')
   		</if>
   		<if test="option=='userId'">
   			AND USER_ID LIKE '%'||#{keyWord}||'%'
   		</if>
   		<if test="option=='userName'">
   			AND USER_NAME LIKE '%'||#{keyWord}||'%'
   		</if>
		ORDER BY USER_ID DESC
		OFFSET #{offset} ROWS FETCH NEXT #{fetchRows} ROWS ONLY
	</select>

	<delete id="userListDelete" parameterType="hashmap">
		DELETE FROM USER_TBL WHERE USER_ID IN
		<foreach collection="list" item="item" open="(" close=")" separator=",">
			#{item}
		</foreach>
	</delete>

	<select id="userCount" parameterType="hashmap" resultType="int">
   		SELECT COUNT(*) AS TOTAL_ROWS
   		FROM USER_TBL
   		WHERE 1=1
   		<if test="option=='all'">
   			AND (USER_ID LIKE '%'||#{keyWord}||'%' OR USER_NAME LIKE '%'||#{keyWord}||'%')
   		</if>
   		<if test="option=='userId'">
   			AND USER_ID LIKE '%'||#{keyWord}||'%'
   		</if>
   		<if test="option=='userName'">
   			AND USER_NAME LIKE '%'||#{keyWord}||'%'
   		</if>
	</select>
	
	<select id="userSelect" parameterType="hashmap" resultType="com.example.teamProject.admin.model.Admin">
		SELECT *
		FROM USER_TBL
		WHERE USER_ID = #{userId}
	</select>
	
	<update id="userUpdate" parameterType="hashmap">
		UPDATE USER_TBL 
		SET USER_NAME=#{userName},EMAIL=#{email},USER_ADDR=#{userAddr},PHONE=#{phone},USER_STATUS=#{userStatus},ROLE=#{role}
		WHERE USER_ID=#{userId}
	</update>
	
	
	
	
	
	
	<select id="sellerListSelect" parameterType="hashmap" resultType="com.example.teamProject.admin.model.Admin">
   		SELECT STORE_ID,STORE_NAME,U.USER_ID,BUSINESS_NO,STORE_INTRO,STORE_ADDR,STORE_PASS,JOIN_CDATE,REJECT_REASON,GRADE_CODE, MEMBERSHIP,REG_DATE FROM SELLER_INFO_TBL S
		LEFT JOIN USER_TBL U ON S.USER_ID=U.USER_ID
   		WHERE 1=1
   		<if test="option=='all'">
   			AND (STORE_ID LIKE '%'||#{keyWord}||'%' OR STORE_NAME LIKE '%'||#{keyWord}||'%')
   		</if>
   		<if test="option=='storeId'">
   			AND STORE_ID LIKE '%'||#{keyWord}||'%'
   		</if>
   		<if test="option=='storeName'">
   			AND STORE_NAME LIKE '%'||#{keyWord}||'%'
   		</if>
   		<if test="flgApp=='true'">
   			AND STORE_PASS='G'
   		</if>
		ORDER BY STORE_ID DESC
		OFFSET #{offset} ROWS FETCH NEXT #{fetchRows} ROWS ONLY
	</select>

	<delete id="sellerListDelete" parameterType="hashmap">
		DELETE FROM SELLER_INFO_TBL WHERE STORE_ID IN
		<foreach collection="list" item="item" open="(" close=")" separator=",">
			#{item}
		</foreach>
	</delete>

	<select id="sellerCount" parameterType="hashmap" resultType="int">
   		SELECT COUNT(*) AS TOTAL_ROWS
   		FROM SELLER_INFO_TBL
   		WHERE 1=1
   		<if test="option=='all'">
   			AND (STORE_ID LIKE '%'||#{keyWord}||'%' OR STORE_NAME LIKE '%'||#{keyWord}||'%')
   		</if>
   		<if test="option=='storeId'">
   			AND STORE_ID LIKE '%'||#{keyWord}||'%'
   		</if>
   		<if test="option=='storeName'">
   			AND STORE_NAME LIKE '%'||#{keyWord}||'%'
   		</if>
	</select>
	
	<select id="sellerSelect" parameterType="hashmap" resultType="com.example.teamProject.admin.model.Admin">
		SELECT * FROM USER_TBL U
		LEFT JOIN
		SELLER_INFO_TBL S
		ON S.USER_ID=U.USER_ID
		WHERE STORE_ID = #{storeId}
	</select>
	
	<update id="sellerUpdate" parameterType="hashmap">
		UPDATE SELLER_INFO_TBL 
		SET STORE_NAME=#{storeName},STORE_ADDR=#{storeAddr},STORE_PASS=#{storePass},REJECT_REASON=#{rejectReason},MEMBERSHIP=#{membership}
		WHERE STORE_ID=#{storeId}
	</update>
	
	<update id="sellerRoleUpdate" parameterType="hashmap">
		UPDATE SELLER_INFO_TBL 
		SET STORE_PASS='R'
		WHERE USER_ID=#{userId}
	</update>
	
	<select id="salesSelect" resultType="HashMap">
		  <![CDATA[
		   WITH MONTHS AS (
			    SELECT LEVEL AS MONTH
			    FROM DUAL
			    CONNECT BY LEVEL <= 12
			)
		SELECT
		    NVL(SUM(CASE WHEN M.MONTH = 1 THEN D.SUBTOTAL END),0) AS JAN,
		    NVL(SUM(CASE WHEN M.MONTH = 2 THEN D.SUBTOTAL END),0) AS FEB,
		    NVL(SUM(CASE WHEN M.MONTH = 3 THEN D.SUBTOTAL END),0) AS MAR,
		    NVL(SUM(CASE WHEN M.MONTH = 4 THEN D.SUBTOTAL END),0) AS APR,
		    NVL(SUM(CASE WHEN M.MONTH = 5 THEN D.SUBTOTAL END),0) AS MAY,
		    NVL(SUM(CASE WHEN M.MONTH = 6 THEN D.SUBTOTAL END),0) AS JUN,
		    NVL(SUM(CASE WHEN M.MONTH = 7 THEN D.SUBTOTAL END),0) AS JUL,
		    NVL(SUM(CASE WHEN M.MONTH = 8 THEN D.SUBTOTAL END),0) AS AUG,
		    NVL(SUM(CASE WHEN M.MONTH = 9 THEN D.SUBTOTAL END),0) AS SEP,
		    NVL(SUM(CASE WHEN M.MONTH = 10 THEN D.SUBTOTAL END),0) AS OCT,
		    NVL(SUM(CASE WHEN M.MONTH = 11 THEN D.SUBTOTAL END),0) AS NOV,
		    NVL(SUM(CASE WHEN M.MONTH = 12 THEN D.SUBTOTAL END),0) AS DEC
		FROM MONTHS M
		LEFT JOIN ORDER_DETAIL_TBL D
		       ON EXTRACT(MONTH FROM (SELECT O.ORDER_DATE FROM ORDER_TBL O WHERE O.ORDER_ID = D.ORDER_ID)) = M.MONTH
		       AND EXTRACT(YEAR FROM (SELECT O.ORDER_DATE FROM ORDER_TBL O WHERE O.ORDER_ID = D.ORDER_ID)) = EXTRACT(YEAR FROM SYSDATE)
		       WHERE STORE_ID=#{storeId}
		  ]]>
	</select>
	
	
	
	
	
	
	
	<select id="membershipListSelect" parameterType="hashmap" resultType="com.example.teamProject.admin.model.Admin">
   		SELECT * FROM MEMBERSHIP_TBL
   		WHERE USER_ID LIKE '%'||#{keyWord}||'%'
		ORDER BY MEMBERSHIP_ID DESC
		OFFSET #{offset} ROWS FETCH NEXT #{fetchRows} ROWS ONLY
	</select>
	
	
	
	
	
	<select id="orderSelect" parameterType="hashmap" resultType="com.example.teamProject.admin.model.Admin">
   		SELECT U.USER_NAME,O.ORDER_ID,P.PRO_NO,P.PRO_NAME,P.PRO_TYPE,O.FULL_ADDRESS,O.TOTAL_PRICE 
		FROM ORDER_TBL O
		LEFT JOIN ORDER_DETAIL_TBL D ON O.ORDER_ID=D.ORDER_ID
		LEFT JOIN PRODUCT_TBL P ON P.PRO_NO=D.PRO_NO
		LEFT JOIN USER_TBL U ON U.USER_ID=O.USER_ID
		WHERE O.USER_ID=#{userId}
	</select>
	
	
	
	
	
	<select id="salesTrendsSelect" resultType="HashMap">
		  <![CDATA[
		    WITH MONTHS AS (
		        SELECT LEVEL AS MONTH
		        FROM DUAL
		        CONNECT BY LEVEL <= 12
		    )
		    SELECT
		        NVL(SUM(CASE WHEN M.MONTH = 1 THEN D.SUBTOTAL END),0) AS JAN,
		        NVL(SUM(CASE WHEN M.MONTH = 2 THEN D.SUBTOTAL END),0) AS FEB,
		        NVL(SUM(CASE WHEN M.MONTH = 3 THEN D.SUBTOTAL END),0) AS MAR,
		        NVL(SUM(CASE WHEN M.MONTH = 4 THEN D.SUBTOTAL END),0) AS APR,
		        NVL(SUM(CASE WHEN M.MONTH = 5 THEN D.SUBTOTAL END),0) AS MAY,
		        NVL(SUM(CASE WHEN M.MONTH = 6 THEN D.SUBTOTAL END),0) AS JUN,
		        NVL(SUM(CASE WHEN M.MONTH = 7 THEN D.SUBTOTAL END),0) AS JUL,
		        NVL(SUM(CASE WHEN M.MONTH = 8 THEN D.SUBTOTAL END),0) AS AUG,
		        NVL(SUM(CASE WHEN M.MONTH = 9 THEN D.SUBTOTAL END),0) AS SEP,
		        NVL(SUM(CASE WHEN M.MONTH = 10 THEN D.SUBTOTAL END),0) AS OCT,
		        NVL(SUM(CASE WHEN M.MONTH = 11 THEN D.SUBTOTAL END),0) AS NOV,
		        NVL(SUM(CASE WHEN M.MONTH = 12 THEN D.SUBTOTAL END),0) AS DEC
		    FROM MONTHS M
		    LEFT JOIN ORDER_DETAIL_TBL D
		           ON EXTRACT(MONTH FROM (SELECT O.ORDER_DATE FROM ORDER_TBL O WHERE O.ORDER_ID = D.ORDER_ID)) = M.MONTH
		           AND EXTRACT(YEAR FROM (SELECT O.ORDER_DATE FROM ORDER_TBL O WHERE O.ORDER_ID = D.ORDER_ID)) = EXTRACT(YEAR FROM SYSDATE)
		  ]]>
	</select>
	
	
	
	
	<select id="qnAListSelect" parameterType="hashmap" resultType="com.example.teamProject.admin.model.Admin">
   		SELECT * FROM QA_TBL
   		WHERE 1=1
   		<if test="option=='all'">
   			AND (STORE_ID LIKE '%'||#{keyWord}||'%' OR USER_ID LIKE '%'||#{keyWord}||'%' OR QUESTION_CONTENT LIKE '%'||#{keyWord}||'%' ANSWER_CONTENT LIKE '%'||#{keyWord}||'%')
   		</if>
   		<if test="option=='userId'">
   			AND USER_ID LIKE '%'||#{keyWord}||'%'
   		</if>
   		<if test="option=='storeId'">
   			AND STORE_ID LIKE '%'||#{keyWord}||'%'
   		</if>
   		<if test="option=='questionContent'">
   			AND QUESTION_CONTENT LIKE '%'||#{keyWord}||'%' 
   		</if>
   		<if test="option=='answerContent'">
   			AND ANSWER_CONTENT LIKE '%'||#{keyWord}||'%'
   		</if>
		ORDER BY QUESTION_DATE DESC
		OFFSET #{offset} ROWS FETCH NEXT #{fetchRows} ROWS ONLY
	</select>
	
	
	<select id="qnACount" parameterType="hashmap" resultType="int">
   		SELECT * FROM QA_TBL
   		WHERE 1=1
   		<if test="option=='all'">
   			AND (STORE_ID LIKE '%'||#{keyWord}||'%' OR USER_ID LIKE '%'||#{keyWord}||'%' OR QUESTION_CONTENT LIKE '%'||#{keyWord}||'%' ANSWER_CONTENT LIKE '%'||#{keyWord}||'%')
   		</if>
   		<if test="option=='userId'">
   			AND USER_ID LIKE '%'||#{keyWord}||'%'
   		</if>
   		<if test="option=='storeId'">
   			AND STORE_ID LIKE '%'||#{keyWord}||'%'
   		</if>
   		<if test="option=='questionContent'">
   			AND QUESTION_CONTENT LIKE '%'||#{keyWord}||'%' 
   		</if>
   		<if test="option=='answerContent'">
   			AND ANSWER_CONTENT LIKE '%'||#{keyWord}||'%'
   		</if>
	</select>
		
	
	
	
	
	
	
	
	

	
	
	
	 

</mapper>